<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

    <title>QR Attendance System</title>
</head>

<body>
    <div class="container">
        <!-- <h1 class="text-center my-2 display-3">Directory ID QR Code</h1> -->
        <p class="mt-3 mb-0">
            <span id="intro-text" class="lead">Enter your Directory ID below to generate your QR code.</span>
            <small id="change-btn" class="text-muted ms-3 link-primary" hidden>[change]</small>
        </p>
        <div id="dir-form">
            <div class="form-floating my-3 form-floating">
                <input type="email" class="form-control" id="dir-id" placeholder="~">
                <label for="floatingInput">Directory ID</label>
            </div>
            <div class="d-grid gap-2">
                <button id="generate-btn" class="btn btn-success btn-lg" type="button" disabled>Generate</button>
            </div>
        </div>
        <div id="qr-container" class="d-grid">
            <div id="qrcode" class="mx-auto my-3"></div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script>
        const dirId = document.getElementById('dir-id');
        const generateBtn = document.getElementById('generate-btn');
        const introText = document.getElementById('intro-text');
        const qrcode = document.getElementById("qrcode");
        const qrContainer = document.getElementById("qr-container");
        const dirForm = document.getElementById("dir-form");
        const changeBtn = document.getElementById("change-btn");

        // Toggle generate button
        dirId.addEventListener('keyup', (e) => {
            generateBtn.disabled = !e.target.value;
        });

        generateBtn.addEventListener('click', () => {
            showCode(dirId.value);
        });

        changeBtn.addEventListener('click', () => {
            hideCode();
        });

        // Show QR code if dirID is saved
        window.localStorage.getItem('dirId') && showCode(window.localStorage.getItem('dirId'));

        // Delete QR code and show form
        function hideCode() {
            introText.innerText = "Enter your Directory ID below to generate your QR code.";
            introText.hidden = false;
            qrcode.innerHTML = "";
            dirForm.hidden = false;
            changeBtn.hidden = true;
        }

        // Create and display QR code
        function showCode(text) {
            const size = Math.min(qrContainer.offsetWidth, window.innerHeight - 50);
            qrcode.innerHTML = "";
            new QRCode(qrcode, {
                text,
                width: size,
                height: size,
            });
            introText.innerText = `Directory ID: ${text}`;
            dirForm.hidden = true;
            changeBtn.hidden = false;
            window.localStorage.setItem('dirId', text);
        }
    </script>
</body>

</html>